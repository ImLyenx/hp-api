<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="global.css" />
    <link rel="stylesheet" href="apidemo.css" />
    <script
      defer
      src="https://kit.fontawesome.com/aa06e5f929.js"
      crossorigin="anonymous"
    ></script>
    <meta name="description" content="Harry Potter Trading Card Game" />
    <link
      rel="shortcut icon"
      href="assets/images/logo.png"
      type="image/x-icon"
    />
    <title>Harry Potter TCG</title>
  </head>
  <body>
    <header>
      <div class="logo">
        <img src="assets/images/logo.png" alt="" />
      </div>
      <nav>
        <ul class="navbar-list">
          <li>
            <a href="/">
              <i class="fas fa-house"></i>
              <span class="nav-link">Home</span></a
            >
          </li>
          <li>
            <a href="/rules"
              ><i class="fas fa-clipboard-check"></i
              ><span class="nav-link">Rules</span></a
            >
          </li>
          <li>
            <a href="/cards"
              ><i class="fas fa-sheet-plastic"></i
              ><span class="nav-link">Cards</span></a
            >
          </li>
        </ul>
      </nav>
      <div class="login">
        <i class="fas fa-right-to-bracket"></i>
      </div>
      <div class="user hidden">
        <i class="fas fa-user-large"></i>
      </div>
      <div class="forms hidden">
        <form class="login-form" onsubmit="handleLogin(event)">
          <label for="login-email">Email adress</label>
          <input type="email" id="login-email" />
          <label for="login-password">Password</label>
          <input type="password" id="login-password" />
          <button type="submit">Login</button>

          <span class="tip">Register</span>
        </form>

        <form class="register-form hidden" onsubmit="handleRegister(event)">
          <label for="register-email">Email adress</label>
          <input type="email" id="register-email" />
          <label for="name">Username</label>
          <input type="text" id="name" />
          <label for="register-password">Password</label>
          <input type="password" id="register-password" />
          <button type="submit">Register</button>
          <span class="tip">Login</span>
        </form>

        <div class="user-menu hidden">
          <p class="user-name"></p>
          <p class="user-email"></p>
          <a href="/profile"><button>Profil</button></a>
          <button class="logout">
            <i class="fas fa-user-large-slash"></i>Logout
          </button>
        </div>
      </div>
      <script>
        const loginButton = document.querySelector(".login");
        const forms = document.querySelector(".forms");
        loginButton.addEventListener("click", () => {
          forms.classList.toggle("hidden");
        });

        function loginStatus() {
          if (localStorage.getItem("token")) {
            document.querySelector(".login").classList.add("hidden");
            document.querySelector(".user").classList.remove("hidden");
            document.querySelector(".forms").classList.add("hidden");
          } else {
            document.querySelector(".login").classList.remove("hidden");
            document.querySelector(".user").classList.add("hidden");
            document.querySelector(".forms").classList.add("hidden");
            document.querySelector(".user-menu").classList.add("hidden");
            document.querySelector(".login-form").classList.remove("hidden");
          }
        }
        loginStatus();

        function handleLogin(e) {
          e.preventDefault();
          const email = document.getElementById("login-email").value;
          const password = document.getElementById("login-password").value;
          fetch("/api/auth/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email, password }),
          })
            .then((response) => response.json())
            .then((data) => {
              localStorage.setItem("token", data.token);
              forms.classList.add("hidden");
              document.querySelector("#login-email").value = "";
              document.querySelector("#login-password").value = "";
              loginStatus();
            })
            .catch((error) => {
              console.error("There was an error!", error);
            });
        }

        function handleRegister(e) {
          e.preventDefault();
          const email = document.getElementById("register-email").value;
          const name = document.getElementById("name").value;
          const password = document.getElementById("register-password").value;
          fetch("/api/users", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email, name, password }),
          })
            .then((response) => response.json())
            .then((data) => {
              localStorage.setItem("token", data.token);
              forms.classList.add("hidden");
              loginStatus();
            })
            .catch((error) => {
              console.error("There was an error!", error);
            });
        }

        const logoutButton = document.querySelector(".logout");
        logoutButton.addEventListener("click", () => {
          localStorage.removeItem("token");
          loginStatus();
        });

        const userMenuButton = document.querySelector(".user");
        const userMenu = document.querySelector(".user-menu");
        const loginForm = document.querySelector(".login-form");
        userMenuButton.addEventListener("click", () => {
          forms.classList.toggle("hidden");
          userMenu.classList.toggle("hidden");
          loginForm.classList.add("hidden");
          fetch("/api/me/profile", {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${localStorage.getItem("token")}`,
            },
          })
            .then((response) => response.json())
            .then((data) => {
              document.querySelector(".user-name").innerText = data.name;
              document.querySelector(".user-email").innerText = data.email;
            })
            .catch((error) => {
              console.error("There was an error!", error);
            });
        });

        const tip = document.querySelectorAll(".tip");
        tip.forEach((element) => {
          element.addEventListener("click", () => {
            document.querySelector(".login-form").classList.toggle("hidden");
            document.querySelector(".register-form").classList.toggle("hidden");
          });
        });
      </script>
      <input type="checkbox" id="burger-toggle" />
      <label for="burger-toggle" class="burger-icon">
        <i class="fas fa-bars"></i>
      </label>
      <div class="burger-menu">
        <ul class="burger-menu-list">
          <li>
            <a href="/">
              <i class="fas fa-house"></i>
              <span>Home</span>
            </a>
          </li>
          <li>
            <a href="/rules">
              <i class="fas fa-clipboard-check"></i>
              <span>Rules</span>
            </a>
          </li>
          <li>
            <a href="/cards">
              <i class="fas fa-sheet-plastic"></i>
              <span>Cards</span>
            </a>
          </li>
        </ul>
      </div>
      <script defer>
        const burgerToggle = document.getElementById("burger-toggle");
        const burgerMenu = document.querySelector(".burger-menu");
        burgerToggle.addEventListener("change", () => {
          if (burgerToggle.checked) {
            burgerMenu.style.transform = "scaleY(1)";
          } else {
            burgerMenu.style.transform = "scaleY(0)";
          }
        });
      </script>
    </header>
    <main class="cards-container">
      <script>
        const res = fetch("https://hp-api.lainocs.fr/characters").then((res) =>
          res.json()
        );
        res.then((data) => {
          const cardsContainer = document.querySelector(".cards-container");
          data.forEach((card) => {
            birthDate = new Date(card.birthday);
            const options = {
              weekday: "long",
              year: "numeric",
              month: "long",
              day: "numeric",
            };
            card.birthday = birthDate.toLocaleDateString("fr-FR", options);

            const cardElement = document.createElement("div");
            cardElement.classList.add("card");
            cardElement.innerHTML = `
            <img src="${card.image}" alt="${card.name}" />
            <h2>${card.name}</h2>
            <p>Maison : ${card.house}</p>
            <p>Acteur : ${card.actor}</p>
            <p>Yeux : ${card.eyes}</p> 
            <p>Anniversaire : ${card.birthday}</p>
            <p>Sang : ${card.blood}</p>
            <p>Baguette : ${card.wand}</p>
            <p>Patronus : ${card.patronus}</p>
            <p>RÃ´le : ${card.role}</p>
            `;
            cardsContainer.appendChild(cardElement);
          });
        });
      </script>
    </main>
    <footer>
      <div class="socials">
        <a href="#"><i class="fab fa-youtube"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
      </div>
      <div class="legal">
        <a href="#">Terms of Use</a>
        <p>&middot;</p>
        <a href="#">Privacy Policy</a>
        <p>&middot;</p>
        <p id="theme-change">Dark Mode</p>
      </div>
      <div class="copyright">
        <p>&copy; Eric Hubert, <span id="copy-date"></span></p>
      </div>
      <script async type="module">
        document.getElementById("copy-date").innerText =
          new Date().getFullYear();

        const themeChange = document.getElementById("theme-change");
        if (localStorage.getItem("theme") === "dark") {
          document.body.classList.add("dark");
          themeChange.innerText = "Light Mode";
        }
        themeChange.addEventListener("click", () => {
          console.log("test");
          document.body.classList.toggle("dark");
          localStorage.setItem(
            "theme",
            document.body.classList.contains("dark") ? "dark" : "light"
          );
          themeChange.innerText = document.body.classList.contains("dark")
            ? "Light Mode"
            : "Dark Mode";
        });
      </script>
    </footer>
  </body>
</html>
